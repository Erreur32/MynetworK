services:
  mynetwork:
    image: ghcr.io/erreur32/mynetwork:latest
    container_name: MynetworK
    restart: unless-stopped
    ports:
      - "${DASHBOARD_PORT:-7505}:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - FREEBOX_HOST=${FREEBOX_HOST:-mafreebox.freebox.fr}
      - FREEBOX_TOKEN_FILE=/app/data/freebox_token.json
      - JWT_SECRET=${JWT_SECRET:-change_me_in_production}
      - CONFIG_FILE_PATH=${CONFIG_FILE_PATH:-/app/config/mynetwork.conf}
      - HOST_ROOT_PATH=${HOST_ROOT_PATH:-/host}
    volumes:
      - mynetwork_data:/app/data
      - /:/host:ro
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  mynetwork_data:
    name: mynetwork_data
