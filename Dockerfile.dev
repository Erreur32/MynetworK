# ===========================================
# MynetworK - Development Dockerfile
# Node 22 Alpine - Hot Reload
# ===========================================

FROM node:22-alpine
# FROM node:20-alpine

WORKDIR /app

# ðŸ”´ Outils de build OBLIGATOIRES pour compiler better-sqlite3 et autres modules natifs
# Ces outils sont nÃ©cessaires pour npm ci qui compile better-sqlite3
# curl: utile pour le debugging en dev (test des routes API)
# iputils-ping: nÃ©cessaire pour le scan rÃ©seau (commande ping)
# iproute2: nÃ©cessaire pour le scan rÃ©seau (commande ip neigh pour dÃ©tection MAC)
# samba-common: contient nmblookup pour NetBIOS/SMB hostname resolution
# Note: getent n'est pas disponible dans Alpine (musl libc), on utilise la lecture directe de /etc/hosts
RUN apk add --no-cache python3 make g++ curl iputils-ping iproute2 samba-common

# RÃ©duction du bruit npm en dev
ENV NODE_ENV=development
RUN npm config set fund false \
 && npm config set audit false

# DÃ©pendances (dev + prod)
COPY package*.json ./
RUN npm ci

# Le code source sera montÃ© via volume (docker-compose)
# => pas de COPY du code ici

# Ports :
# - Frontend (Vite) : 5173
# - Backend API     : 3003
EXPOSE 5173 3003

# Lancement dev (vite + api en watch)
CMD ["npm", "run", "dev"]
