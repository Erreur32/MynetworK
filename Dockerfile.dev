# ===========================================
# MynetworK - Development Dockerfile
# Node 22 Alpine - Hot Reload
# ===========================================

FROM node:22-alpine
# FROM node:20-alpine

WORKDIR /app

# Required build tools to compile better-sqlite3 and other native modules.
# These are needed for npm ci which compiles better-sqlite3.
# curl: useful for dev debugging (API route tests).
# iputils-ping: required for network scan (ping command).
# iproute2: required for network scan (ip neigh for MAC detection).
# samba-common: provides nmblookup for NetBIOS/SMB hostname resolution.
# Note: getent is not available on Alpine (musl libc); we use direct /etc/hosts reading.
RUN apk add --no-cache python3 make g++ curl iputils-ping iproute2 samba-common

# Reduce npm noise in dev
ENV NODE_ENV=development
RUN npm config set fund false \
 && npm config set audit false

# Dependencies (dev + prod)
COPY package*.json ./
RUN npm ci

# Source code will be mounted via volume (docker-compose)
# => no COPY of source here

# Ports:
# - Frontend (Vite): 5173
# - Backend API:    3003
EXPOSE 5173 3003

# Start dev (vite + API in watch mode)
CMD ["npm", "run", "dev"]
